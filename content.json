{"meta":{"title":"é£å£ä¹‹å·…","subtitle":"","description":"","author":"hanny","url":"http://example.com","root":"/"},"pages":[{"title":"about","date":"2021-01-06T06:42:10.000Z","updated":"2021-01-07T06:35:45.367Z","comments":true,"path":"about/index.html","permalink":"http://example.com/about/index.html","excerpt":"","text":"å…³äºåšå®¢æœ€è¿‘è‡ªå·±åœ¨ç ”ç©¶äº‘è®¡ç®—æ–¹å‘ï¼Œä¸­é€”è¸©äº†ä¸å°‘çš„å‘èµ°äº†ä¸å°‘å¼¯è·¯è¾›è‹¦è‡³æï½ï½ï½ã€‚ ä¸ºäº†èƒ½å¤Ÿåè¾ˆä»¬å°‘èµ°å¼¯è·¯ï¼Œå› æ­¤æˆ‘æ‰“ç®—æŠŠæˆ‘çš„ä¸ªäººç»éªŒè®°å½•ä¸‹æ¥ï¼Œå¸®åŠ©æ›´å¤šçš„è¿½æ¢¦è€…ã€‚äºæ˜¯åœ¨è¿™ä¸ªæƒ³æ³•ä¸­å°±è¯ç”Ÿäº†è¿™ä¸ªåšå®¢ã€‚ å…³äºè‡ªå·±æˆ‘æ˜¯90å¹´ä»£å°¾å·´å‡ºç”Ÿçš„äººï¼Œç®—æ˜¯ä¸€ä¸ª90åã€‚ä¼°è®¡ä½ ç°åœ¨çœ‹åˆ°è¿™ä¸ªä»‹ç»çš„æ—¶å€™è§‰å¾—ï¼Œå“‡ï¼Œè¿™ä¸ªå”å”çœŸè€ã€‚ æœŸé—´ä»äº‹è¿‡ç½‘ç»œå®‰å…¨ï¼Œå¾®æœåŠ¡æ¡†æ¶å¼€å‘ï¼Œäº‘è®¡ç®—ï¼ŒåŒºå—é“¾ç­‰ä¸€äº›åº•å±‚ç ”ç©¶ã€‚ç°åœ¨ä»äº‹goè¯­è¨€åç«¯å¼€å‘ï¼Œåœ¨ç¨‹åºçŒ¿çš„è·¯ä¸Šä¸€è·¯ç‹‚å¥”ã€‚ å“ï¼Œéšç€çŸ¥è¯†çš„å¢åŠ ï¼Œæˆ‘çš„å‘é™…çº¿ä¹Ÿä¸€è·¯å¢é«˜ã€‚æ­£æœç€åœ°ä¸­æµ·æ–¹å‘å‘å±•ã€‚å“ˆï¼Œæˆ‘æ— æ‰€è°“å•¦ã€‚ ç»“è¯­æ„Ÿè°¢hexoå’Œhexo-casperçš„æŠ€æœ¯æ”¯æŒã€‚ ä¸ºå¼€æºäº‹ä¸šç‚¹èµğŸ‘ã€‚"}],"posts":[{"title":"ä½¿ç”¨operator-sdkç¬”è®°","slug":"ä½¿ç”¨operator-sdkç¬”è®°","date":"2021-01-18T03:21:30.878Z","updated":"2021-01-21T09:59:31.838Z","comments":true,"path":"2021/01/18/ä½¿ç”¨operator-sdkç¬”è®°/","link":"","permalink":"http://example.com/2021/01/18/%E4%BD%BF%E7%94%A8operator-sdk%E7%AC%94%E8%AE%B0/","excerpt":"","text":"brewå®‰è£…operator-sdk brew install operator-sdk åˆå§‹åŒ–é¡¹ç›® åˆ›å»ºé¡¹ç›®å mkdir memcached-operator cd memcached-operator 1234567891011121314151617181920212223242. æ–°å»ºé¡¹ç›® 1. operator-sdk init --domain&#x3D;example.com --repo&#x3D;github.com&#x2F;example-inc&#x2F;memcached-operator![åˆå§‹åŒ–é¡¹ç›®](ä½¿ç”¨operator-sdkç¬”è®°&#x2F;åˆå§‹åŒ–é¡¹ç›®.png) 2. ç›®å½•ç»“æ„ ![ç›®å½•ç»“æ„1](ä½¿ç”¨operator-sdkç¬”è®°&#x2F;ç›®å½•ç»“æ„1.png) - configä¸‹è·å¾—å¯åŠ¨é…ç½® &#96;&#96;&#96;sh . â”œâ”€â”€ certmanager â”œâ”€â”€ crd â”œâ”€â”€ default â”œâ”€â”€ manager â”œâ”€â”€ prometheus â”œâ”€â”€ rbac â”œâ”€â”€ samples â”œâ”€â”€ scorecard â””â”€â”€ webhook 1. Default åŒ…å«kustomizeåŸºç¡€ï¼Œåœ¨æ ‡å‡†é…ç½®ä¸­å¯åŠ¨æ§åˆ¶å™¨ 2. manageræ§åˆ¶é›†ç¾¤podå¯åŠ¨ main.goå¯åŠ¨æ–‡ä»¶ PROJECTæ–°ç»„ä»¶çš„å…ƒæ•°æ® åˆ›å»ºæ‰©å±•å¼API åˆ›å»ºapi operator-sdk create api --group=cache --version v1 --kind Memcached --resource=true --controller=true 1234567891011![åˆ›å»ºæ‰©å±•api](ä½¿ç”¨operator-sdkç¬”è®°&#x2F;åˆ›å»ºæ‰©å±•api.png)## ç¼–è¯‘æ¨é€operatoré•œåƒ1. &#96;&#96;&#96;sh make docker-build docker-push IMG&#x3D;&lt;some-registry&gt;&#x2F;&lt;project-name&gt;:&lt;tag&gt; ---ä¸Šé¢æ˜¯æ¨¡ç‰ˆ make docker-build docker-push IMG&#x3D;cainiaohui&#x2F;memcached-operator:v0.1 ## è¿è¡Œoperator ```shmake installmake deploy IMG=/: 123452.åˆ›å»ºcustom resource&#96;&#96;&#96;shkubectl apply -f config&#x2F;samples&#x2F;cache_v1_memcached.yaml æ—¥å¿—æŸ¥çœ‹ 1kubectl logs deployment.apps/memcached-operator-controller-manager -n memcached-operator-system -c manager æ¸…é™¤CR 1kubectl delete -f config/samples/cache_v1_memcached.yaml 5.å¸è½½operatorå’ŒCRDs 1kustomize build config/default | kubectl delete -f - è¯¦ç»†åˆ†æä»mainå‡½æ•°å¼€å§‹ é€šè¿‡newManagerå°è£…æŒ‡mgrå˜é‡ä¸­ 1234567mgr, err := ctrl.NewManager(ctrl.GetConfigOrDie(), ctrl.Options&#123; Scheme: scheme, MetricsBindAddress: metricsAddr, Port: 9443, LeaderElection: enableLeaderElection, LeaderElectionID: &quot;f1c5ece8.example.com&quot;,&#125;) ç»™è‡ªå®šä¹‰çš„controlleråˆ†é…clientå‚æ•°ã€logå’Œschemeï¼Œå¹¶ä¸”å»ºç«‹manager 12345678if err = (&amp;controllers.MemcachedReconciler&#123; Client: mgr.GetClient(), Log: ctrl.Log.WithName(&quot;controllers&quot;).WithName(&quot;Memcached&quot;), Scheme: mgr.GetScheme(),&#125;).SetupWithManager(mgr); err != nil &#123; setupLog.Error(err, &quot;unable to create controller&quot;, &quot;controller&quot;, &quot;Memcached&quot;) os.Exit(1)&#125; æ˜¯å¦éœ€è¦åˆ›å»ºå¤šä¸ªAPIå’Œæ§åˆ¶å™¨ å¦‚æœéœ€è¦åˆ›å»ºå¤šä¸ªAPIç»„ï¼Œéœ€è¦å¼€å¯ multigroup=true å¼€å¯æ–¹å¼ä¸¤ç§ ä¿®æ”¹PROJECT 123domain: example.comlayout: go.kubebuilder.io/v2multigroup: true //æ‰‹åŠ¨æ·»åŠ  åˆ›å»ºAPIæ—¶å€™å®šä¹‰ 1operator-sdk edit --multigroup=true åˆ›å»ºæ–°çš„APIå’Œcontroller operator-sdk create api --group=cache1 --version=v1alpha1 --kind=Memcached1 12345678910111213141516171819202122232425æœŸé—´ä¼šæç¤ºResource å’Œ Controller![è‡ªå®šä¹‰åˆ›å»ºå¤šä¸ªapi2](ä½¿ç”¨operator-sdkç¬”è®°&#x2F;è‡ªå®šä¹‰åˆ›å»ºå¤šä¸ªapi2.png)- å¼€å¯multigroupåï¼ŒåŸæœ¬çš„ç›®å½•ç»“æ„å°±æ”¹å˜äº†å¦‚ä¸‹å›¾ã€‚controllerå±‚ä¸‹ä¼šå¤šä¸€ä¸ªgroupæ–‡ä»¶å¤¹ã€å¹¶ä¸”apiä¹Ÿä¼šå˜æˆapisï¼Œè€Œä¸”ä¸‹é¢çš„ç›®å½•ç”±ä¸¤å±‚å˜æˆä¸‰å±‚ã€‚ ![å¼€å¯multigroupç›®å½•ç»“æ„å˜åŒ–1](ä½¿ç”¨operator-sdkç¬”è®°&#x2F;å¼€å¯multigroupç›®å½•ç»“æ„å˜åŒ–1.png)## å®šä¹‰API- è‡ªå®šä¹‰CRèµ„æºçš„APIéœ€è¦å¡«å†™åœ¨apis&#x2F;cache1&#x2F;v1alpha1&#x2F;memcached1_types.go ![ä¿®æ”¹CRå±æ€§1](ä½¿ç”¨operator-sdkç¬”è®°&#x2F;ä¿®æ”¹CRå±æ€§1.png)- Memcached1çš„ç»“æ„ä½“å°è£…ä¸Šé¢specå’Œstatusç»„æˆä¸€ä¸ªAPIå€¼ &#96;&#96;&#96;go type Memcached1 struct &#123; metav1.TypeMeta &#96;json:&quot;,inline&quot;&#96; metav1.ObjectMeta &#96;json:&quot;metadata,omitempty&quot;&#96; Spec Memcached1Spec &#96;json:&quot;spec,omitempty&quot;&#96; Status Memcached1Status &#96;json:&quot;status,omitempty&quot;&#96; &#125; ## æ›´æ–°generated 1make generate makefileç›®æ ‡å°†è°ƒç”¨controller-genå®ç”¨ç¨‹åºæ¥æ›´æ–°api/v1alpha1/zz_generated.deepcopy.goæ–‡ä»¶ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬APIçš„Goç±»å‹å®šä¹‰å®ç°äº†runtime.Objectæ‰€æœ‰Kindç±»å‹å¿…é¡»å®ç°çš„æ¥å£ ç”Ÿæˆcrd configæ–‡ä»¶1make manifests makefileç›®æ ‡å°†è°ƒç”¨controller-genç”ŸæˆCRDæ¸…å•ï¼Œä½äºconfig/crd/bases/cache.example.com_memcacheds.yaml æœŸé—´ä¼šå°†OpenAPIv3æ¨¡å¼æ·»åŠ åˆ°spec.validationå—ä¸­çš„CRDæ¸…å•ä¸­ã€‚æ­¤éªŒè¯å—å…è®¸Kubernetesåœ¨åˆ›å»ºæˆ–æ›´æ–°Memcachedè‡ªå®šä¹‰èµ„æºæ—¶éªŒè¯å…¶å±æ€§ã€‚ æ§åˆ¶å™¨ç›‘æ§èµ„æºä»£ç  Controllers/cache1/memcached1_controller.goçš„SetupWithManagerå‡½æ•°æ„å»ºoperatorã€‚ Managerä¸ºæ–¹æ³•åº“ 1234567891011func (r *Memcached1Reconciler) SetupWithManager(mgr ctrl.Manager) error &#123; return ctrl.NewControllerManagedBy(mgr). For(&amp;cache1v1alpha1.Memcached1&#123;&#125;). WithOptions(controller.Options&#123; //æ‰‹åŠ¨æ·»åŠ  MaxConcurrentReconciles: 2, //æ‰‹åŠ¨æ·»åŠ  Reconciler: nil, //æ‰‹åŠ¨æ·»åŠ  RateLimiter: nil, //æ‰‹åŠ¨æ·»åŠ  Log: nil, //æ‰‹åŠ¨æ·»åŠ  &#125;). Complete(r)&#125; æ‰‹åŠ¨æ·»åŠ éƒ¨åˆ†ä¸ºè®¾ç½®æ§åˆ¶å™¨çš„æœ€å¤§å¹¶å‘æ•°ã€‚ æ¯ä¸ªControlleréƒ½æœ‰ä¸€ä¸ªReconcilerå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å…·æœ‰Reconcile()å®ç°åè°ƒå¾ªç¯çš„æ–¹æ³•ã€‚å‘åè°ƒå¾ªç¯ä¼ é€’Requestå‚æ•°ï¼Œè¯¥å‚æ•°æ˜¯å‘½åç©ºé—´/åç§°é”®ï¼Œç”¨äºä»ç¼“å­˜ä¸­æŸ¥æ‰¾ä¸»è¦èµ„æºå¯¹è±¡Memcachedï¼š(å¹¶ä¸”ç”¨æ¥å¤„ç†rbac) 1234567891011// +kubebuilder:rbac:groups=cache1.example.com,resources=memcached1s,verbs=get;list;watch;create;update;patch;delete// +kubebuilder:rbac:groups=cache1.example.com,resources=memcached1s/status,verbs=get;update;patchfunc (r *Memcached1Reconciler) Reconcile(req ctrl.Request) (ctrl.Result, error) &#123; _ = context.Background() _ = r.Log.WithValues(&quot;memcached1&quot;, req.NamespacedName) // your logic here return ctrl.Result&#123;&#125;, nil&#125; æ›´æ–°crd 1make manifests æ„å»ºå¹¶ä¸”è¿è¡Œoperator 1$ make install æ„å»ºimage,æ¨é€images 123export USERNAME = &lt;query-username&gt;make docker-build IMG=quay.io/$USERNAME/memcached-operator:v0.0.1make docker-push IMG=quay.io/$USERNAME/memcached-operator:v0.0.1 éƒ¨ç½²operator 1make deploy IMG=quay.io/$USERNAME/memcached-operator:v0.0.1 æ¸…ç†æ•°æ®ä¸¤ç§æ–¹å¼ æ·»åŠ Makefile undeployå­—æ®µ 12undeploy: $KUSTOMIZE build config/default | kubectl delete -f - å®Œæˆå®‰è£…åé‡‡ç”¨å‘½ä»¤å½¢å¼åˆ é™¤èµ„æº 1make undeploy operatoræ“ä½œèŒƒå›´ éœ€è¦åœ¨NewManageræ—¶å®šä¹‰namesapce 12345678mgr, err := ctrl.NewManager(ctrl.GetConfigOrDie(), ctrl.Options&#123; Scheme: scheme, MetricsBindAddress: metricsAddr, Port: 9443, LeaderElection: enableLeaderElection, LeaderElectionID: &quot;f1c5ece8.example.com&quot;, Namespace: &quot;operator-namespace&quot;, //æ‰‹åŠ¨æ·»åŠ  &#125;) ç›‘æ§ä¸€ç»„åç§°ç©ºé—´ 1234567891011multiNamespace := []string&#123;&quot;foo&quot;, &quot;bar&quot;&#125; //æ‰‹åŠ¨æ·»åŠ ï¼Œä¸€ç»„åç§°ç©ºé—´mgr, err := ctrl.NewManager(ctrl.GetConfigOrDie(), ctrl.Options&#123; Scheme: scheme, MetricsBindAddress: metricsAddr, Port: 9443, LeaderElection: enableLeaderElection, LeaderElectionID: &quot;f1c5ece8.example.com&quot;, Namespace: &quot;operator-namespace&quot;, //æ‰‹åŠ¨æ·»åŠ  æ‰€å±åç§°ç©ºé—´ NewCache: cache.MultiNamespacedCacheBuilder(multiNamespace), //æ‰‹åŠ¨æ·»åŠ  ç›‘æ§çš„åç§°ç©ºé—´&#125;) æˆäºˆoperator permissions æ˜¯ç”±config/rbacä¸‹çš„role.yaml å’Œ role_binding.yamlæ¥å†³å®šçš„ã€‚ å¦‚æœéœ€è¦æ›´æ”¹operatorçš„æƒé™éœ€è¦æ›´æ”¹è¿™ä¸¤ä¸ªæ–‡ä»¶ é‡‡ç”¨roleæƒé™æ¥æ›¿æ¢rolebindingï¼Œ éœ€è¦æŒ‡å®šnamespaceå¦‚ä¸Šé¢ç¬¬ä¸€æ¡å¢åŠ newManagerå‡½æ•°çš„namespaceå€¼ã€‚ ä¿®æ”¹RBAC markersçš„å†…å®¹(ä¸Šé¢çš„å†…å®¹)-å¯åŠ¨make manifestè‡ªåŠ¨ä¿®æ”¹role.yamlæ–‡ä»¶ ä½¿ç”¨è¯»å–ç¯å¢ƒå˜äº†çš„å½¢å¼ï¼Œæ•è·namespace 12345678910111213// getWatchNamespace returns the Namespace the operator should be watching for changesfunc getWatchNamespace() (string, error) &#123; //æ‰‹åŠ¨æ·»åŠ  ä½¿ç”¨ç¯å¢ƒå˜é‡çš„å½¢å¼æ§åˆ¶ // WatchNamespaceEnvVar is the constant for env variable WATCH_NAMESPACE // which specifies the Namespace to watch. // An empty value means the operator is running with cluster scope. var watchNamespaceEnvVar = &quot;WATCH_NAMESPACE&quot; ns, found := os.LookupEnv(watchNamespaceEnvVar) if !found &#123; return &quot;&quot;, fmt.Errorf(&quot;%s must be set&quot;, watchNamespaceEnvVar) &#125; return ns, nil&#125; å…¶æ¬¡ä¿®æ”¹NewManagerçš„namespaceçš„éƒ¨åˆ†ã€‚ è¿˜éœ€è¦ä¿®æ”¹config/manager/manager.yaml 123456789101112131415161718192021spec: containers: - command: - /manager args: - --enable-leader-election image: controller:latest name: manager resources: limits: cpu: 100m memory: 30Mi requests: cpu: 100m memory: 20Mi # ä»¥ä¸‹éƒ½æ˜¯æ‰‹åŠ¨æ·»åŠ éƒ¨åˆ† env: - name: WATCH_NAMESPACE valueFrom: - fieldRef: fieldPath: metadata.namespace ä»¥ä¸Šmanagerä¿®æ”¹ WATCH_NAMESPACE here will always be set as the namespace where the operator is deployed. æ·»åŠ å¤šä¸ªnamespaceçš„æ–¹æ³• æ·»åŠ è¾…åŠ©å‡½æ•°","categories":[],"tags":[]},{"title":"md5sumå’Œmd5å·¥å…·çš„ä½¿ç”¨","slug":"md5å·¥å…·ä½¿ç”¨","date":"2021-01-07T08:02:06.444Z","updated":"2021-01-07T08:34:46.684Z","comments":true,"path":"2021/01/07/md5å·¥å…·ä½¿ç”¨/","link":"","permalink":"http://example.com/2021/01/07/md5%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/","excerpt":"","text":"md5sumå·¥å…·çš„ä½¿ç”¨(linux)123456789101112131415161718192021222324ç”¨æ³•ï¼šmd5sum [é€‰é¡¹]... [æ–‡ä»¶]...æ˜¾ç¤ºæˆ–æ£€æŸ¥ MD5(128-bit) æ ¡éªŒå’Œã€‚è‹¥æ²¡æœ‰æ–‡ä»¶é€‰é¡¹ï¼Œæˆ–è€…æ–‡ä»¶å¤„ä¸º&quot;-&quot;ï¼Œåˆ™ä»æ ‡å‡†è¾“å…¥è¯»å–ã€‚ -b, --binary ä»¥äºŒè¿›åˆ¶æ¨¡å¼è¯»å– -c, --check ä»æ–‡ä»¶ä¸­è¯»å–MD5 çš„æ ¡éªŒå€¼å¹¶äºˆä»¥æ£€æŸ¥ --tag create a BSD-style checksum -t, --text ä»¥çº¯æ–‡æœ¬æ¨¡å¼è¯»å–(é»˜è®¤) Note: There is no difference between binary and text mode option on GNU system.The following four options are useful only when verifying checksums: --quiet don&#x27;t print OK for each successfully verified file --status don&#x27;t output anything, status code shows success --strict exit non-zero for improperly formatted checksum lines -w, --warn warn about improperly formatted checksum lines --help æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯å¹¶é€€å‡º --version æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯å¹¶é€€å‡ºThe sums are computed as described in RFC 1321. When checking, the inputshould be a former output of this program. The default mode is to printa line with checksum, a character indicating input mode (&#x27;*&#x27; for binary,space for text), and name for each FILE. ä»ä¸Šé¢çš„å†…å®¹å¯ä»¥çœ‹åˆ°md5sumç¡®å®å¼ºå¤§ã€‚ æ¯”å¦‚æˆ‘æƒ³æ£€éªŒyumæ–‡ä»¶çš„md5ç  12md5sum yumaf3eaddb82d77ebb8eaa42e27f61b2ed yum md5å·¥å…·çš„ä½¿ç”¨(mac) Macä½œä¸ºå¼€å‘è€…çš„æ“ä½œç³»ç»Ÿï¼Œè¦æ˜¯æ²¡æœ‰md5sumé‚£å°±â€¦.è‹¹æœå…¬å¸åˆ†è£…çš„å·¥å…·æ›´åŠ ç›´æ¥å°±å«md5ï¼Œä»–å°±æ˜¯ç”¨æ¥æ£€éªŒmd5ç çš„ã€‚ ä½¿ç”¨md5 123md5 prometheus-2.24.0.linux-arm64.tar.gzMD5 (prometheus-2.24.0.linux-arm64.tar.gz) = a400889be94e5beae64bcbdfa0896fee ä»¥ä¸Šå°±æ˜¯ä½¿ç”¨è¯´æ˜ã€‚ã€‚ã€‚ã€‚ã€‚ 123md5 --hmd5: illegal option -- -usage: md5 [-pqrtx] [-s string] [files ...] ï¼ˆWCè¿™æ“ä½œè¯´æ˜èƒ½æ›´ç®€é™‹ç‚¹å—ï¼Ÿï¼‰","categories":[],"tags":[]},{"title":"kubeedgeæºç åˆ†æ(ä¸€).md","slug":"kubeedgeæºç åˆ†æ(ä¸€)","date":"2021-01-05T12:50:20.798Z","updated":"2021-01-05T12:51:54.052Z","comments":true,"path":"2021/01/05/kubeedgeæºç åˆ†æ(ä¸€)/","link":"","permalink":"http://example.com/2021/01/05/kubeedge%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90(%E4%B8%80)/","excerpt":"","text":"æºç åˆ†æ ç»„ä»¶å ç»„ä»¶åŠŸèƒ½ edge_mesh æœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆ edge_site è¾¹ç¼˜ç‹¬ç«‹é›†ç¾¤è§£å†³æ–¹æ¡ˆ mappers ç‰©è”ç½‘åè®®å®ç°åŒ… keadm kubeedgeçš„ä¸€é”®éƒ¨ç½²å·¥å…· ç»„ä»¶å ä»£ç ç›®å½• ç»„ä»¶å¯åŠ¨å…¥å£ cloudcore kubeedge/cloud kubeedge/cloud/cmd/cloudcore/cloudcore.goï¼Œkubeedge/cloud/cmd/admission/admission.goï¼Œkubeedge/cloud/cmd/csidriver/csidriver.go edgecore kubeedge/edge kubeedge/edge/cmd/edgecore/edgecore.go edge_mesh kubeedge/edgemesh kubeedge/edgemesh/cmd/edgemesh.go edge_site kubeedge/edgesite kubeedge/edgesite/cmd/edgesite.go cloudcoreæºç åˆ†æ123456789101112131415161718192021222324252627282930313233343536373839404142434445func main() &#123; command := app.NewCloudCoreCommand() //cobraè°ƒç”¨æ–°å»ºå‡½æ•° logs.InitLogs() defer logs.FlushLogs() if err := command.Execute(); err != nil &#123; os.Exit(1) &#125;&#125;-------------------------- app.NewCloudCoreCommand()func NewCloudCoreCommand() *cobra.Command &#123; opts := options.NewCloudCoreOptions() cmd := &amp;cobra.Command&#123; Use: &quot;cloudcore&quot;, Long: ..., Run: func(cmd *cobra.Command, args []string) &#123; ... config, err := opts.Config() ... registerModules(config) //æ³¨å†Œcloudcoreçš„åŠŸèƒ½æ¨¡å— ... core.Run() //å¯åŠ¨æ‰€æœ‰æ³¨å†Œæ¨¡ç‰ˆ &#125;, &#125; ... return cmd&#125;-------------------------- registerModules(config)// registerModules register all the modules started in cloudcorefunc registerModules(c *v1alpha1.CloudCoreConfig) &#123; cloudhub.Register(c.Modules.CloudHub, c.KubeAPIConfig) edgecontroller.Register(c.Modules.EdgeController, c.KubeAPIConfig, &quot;&quot;, false) devicecontroller.Register(c.Modules.DeviceController, c.KubeAPIConfig) synccontroller.Register(c.Modules.SyncController, c.KubeAPIConfig) cloudstream.Register(c.Modules.CloudStream)&#125;-------------------------- core.Run()// Run starts the modules and in the end does module cleanupfunc Run() &#123; // Address the module registration and start the core StartModules() // monitor system signal and shutdown gracefully GracefulShutdown()&#125; æ€»ç»“ä¸Šé¢ä»£ç ï¼Œé€šè¿‡cobraè‡ªåŠ¨å¯åŠ¨NewCloudCoreCommandï¼ŒæŠŠæ‰€æœ‰æ¨¡å—æ³¨å†Œåˆ°registerModulesï¼Œä½¿ç”¨Runå‡½æ•°å¯åŠ¨ edgecoreæºç åˆ†æ12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970func main() &#123; command := app.NewEdgeCoreCommand() //cobraè°ƒç”¨æ–°å»ºå‡½æ•° logs.InitLogs() defer logs.FlushLogs() if err := command.Execute(); err != nil &#123; os.Exit(1) &#125;&#125;-------------------------- app.NewEdgeCoreCommand()func NewEdgeCoreCommand() *cobra.Command &#123; opts := options.NewEdgeCoreOptions() cmd := &amp;cobra.Command&#123; Use: &quot;edgecore&quot;, Long: ..., Run: func(cmd *cobra.Command, args []string) &#123; ... config, err := opts.Config() ... // Check the running environment by default checkEnv := os.Getenv(&quot;CHECK_EDGECORE_ENVIRONMENT&quot;) if checkEnv != &quot;false&quot; &#123; // Check running environment before run edge core if err := environmentCheck(); err != nil &#123; klog.Fatal(fmt.Errorf(&quot;Failed to check the running environment: %v&quot;, err)) &#125; &#125; // get edge node local ip if config.Modules.Edged.NodeIP == &quot;&quot; &#123; hostnameOverride, err := os.Hostname() if err != nil &#123; hostnameOverride = constants.DefaultHostnameOverride &#125; localIP, _ := util.GetLocalIP(hostnameOverride) config.Modules.Edged.NodeIP = localIP &#125; registerModules(config) //edgecoreæ³¨å†Œæ¨¡å— // start all modules core.Run() &#125;, &#125; ... return cmd&#125;-------------------------- åŒç†æ³¨å†Œæ¨¡å— registerModules(config)func registerModules(c *v1alpha1.EdgeCoreConfig) &#123; devicetwin.Register(c.Modules.DeviceTwin, c.Modules.Edged.HostnameOverride) edged.Register(c.Modules.Edged) edgehub.Register(c.Modules.EdgeHub, c.Modules.Edged.HostnameOverride) eventbus.Register(c.Modules.EventBus, c.Modules.Edged.HostnameOverride) edgemesh.Register(c.Modules.EdgeMesh) metamanager.Register(c.Modules.MetaManager) servicebus.Register(c.Modules.ServiceBus) edgestream.Register(c.Modules.EdgeStream, c.Modules.Edged.HostnameOverride, c.Modules.Edged.NodeIP) test.Register(c.Modules.DBTest) // Note: Need to put it to the end, and wait for all models to register before executing dbm.InitDBConfig(c.DataBase.DriverName, c.DataBase.AliasName, c.DataBase.DataSource)&#125;-------------------------- core.Run()// Run starts the modules and in the end does module cleanupfunc Run() &#123; // Address the module registration and start the core StartModules() // monitor system signal and shutdown gracefully GracefulShutdown()&#125; edgemesh.Registeræ¨¡å—å·²ç»æ•´åˆåˆ°registerModulesé‡Œé¢å»äº† edgesiteæºç åˆ†æ123456789101112131415161718192021222324252627282930313233func main() &#123; command := app.NewEdgeSiteCommand() //åˆ›å»º logs.InitLogs() defer logs.FlushLogs() if err := command.Execute(); err != nil &#123; os.Exit(1) &#125;&#125;func NewEdgeSiteCommand() *cobra.Command &#123; opts := options.NewEdgeSiteOptions() cmd := &amp;cobra.Command&#123; Use: &quot;edgesite&quot;, Long: ..., Run: func(cmd *cobra.Command, args []string) &#123; ... registerModules(config) //æ³¨å†Œ // start all modules core.Run() //æ¿€æ´» &#125;, &#125; ... return cmd&#125;func registerModules(c *v1alpha1.EdgeSiteConfig) &#123; edged.Register(c.Modules.Edged) edgecontroller.Register(c.Modules.EdgeController, c.KubeAPIConfig, c.Modules.Edged.HostnamgieOverride, true) metamanager.Register(c.Modules.MetaManager) // Nodte: Need to put it to the end, and wait for all models to register before executing dbm.InitDBConfig(c.DataBase.DriverName, c.DataBase.AliasName, c.DataBase.DataSource)&#125; å…±ç”¨æ¡†æ¶beehive ä»¥ä¸‹æ³¨å†Œè¿è¡Œæ¨¡å—(edgecore/cloudcore/edgemesh)ä»£ç ä¸€è‡´æ€§å¾ˆé«˜ï¼Œæˆ‘å°±å•åˆ†æcloudcoreå¦å¤–ä¸¤ä¸ªçš„é€»è¾‘ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ çœ‹çœ‹Registerå‡½æ•°åšäº†äº›ä»€ä¹ˆ 123456789101112131415161718192021222324252627282930313233func Register(hub *v1alpha1.CloudHub, kubeAPIConfig *v1alpha1.KubeAPIConfig) &#123; hubconfig.InitConfigure(hub, kubeAPIConfig) core.Register(newCloudHub(hub.Enable)) //ä½¿ç”¨æ¡†æ¶è¿›è¡Œæ³¨å†Œæ“ä½œ&#125;-------------è¿›åˆ°Registertype Module interface &#123; Name() string Group() string Start() Enable() bool&#125;var ( // Modules map modules map[string]Module disabledModules map[string]Module)func init() &#123; modules = make(map[string]Module) disabledModules = make(map[string]Module)&#125;// Register register modulefunc Register(m Module) &#123; if m.Enable() &#123; modules[m.Name()] = m klog.Infof(&quot;Module %v registered successfully&quot;, m.Name()) &#125; else &#123; disabledModules[m.Name()] = m klog.Warningf(&quot;Module %v is disabled, do not register&quot;, m.Name()) &#125;&#125; å¯ä»¥çœ‹åˆ°modulesæ˜¯ä¸€ä¸ªmapï¼ŒModuleæ˜¯ä¸€ä¸ªæ¥å£ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªæ–¹æ³•ã€‚Registerçš„ä½œç”¨å°±æ˜¯æŠŠModuleæ¥å£æ”¾åˆ°å…¨å±€å˜é‡modulesä¸­ã€‚ å†çœ‹çœ‹core.Run()çš„æ–¹æ³•ã€‚ 1234567// Run starts the modules and in the end does module cleanupfunc Run() &#123; // Address the module registration and start the core StartModules() // monitor system signal and shutdown gracefully GracefulShutdown()&#125; è¿½åˆ°StartModules 1234567891011121314151617181920// StartModules starts modules that are registeredfunc StartModules() &#123; beehiveContext.InitContext(beehiveContext.MsgCtxTypeChannel) modules := GetModules() for name, module := range modules &#123; //Init the module beehiveContext.AddModule(name) //Assemble typeChannels for sendToGroup beehiveContext.AddModuleGroup(name, module.Group()) go module.Start() klog.Infof(&quot;Starting module %v&quot;, name) &#125;&#125;// GetModules gets modules mapfunc GetModules() map[string]Module &#123; return modules&#125; StartModules åŠŸèƒ½ï¼šå¾ªç¯éå†registerçš„modulå¹¶åŠ å…¥åˆ°beehiveContexté‡Œé¢å»ã€‚gorotine startæ–¹æ³•å¯åŠ¨æ‰€æœ‰moduleæ’ä»¶ã€‚ 1234567891011121314151617// GracefulShutdown is if it gets the special signals it does modules cleanupfunc GracefulShutdown() &#123; c := make(chan os.Signal) signal.Notify(c, syscall.SIGINT, syscall.SIGHUP, syscall.SIGTERM, syscall.SIGQUIT, syscall.SIGILL, syscall.SIGTRAP, syscall.SIGABRT) select &#123; case s := &lt;-c: klog.Infof(&quot;Get os signal %v&quot;, s.String()) //Cleanup each modules beehiveContext.Cancel() modules := GetModules() for name, _ := range modules &#123; klog.Infof(&quot;Cleanup module %v&quot;, name) beehiveContext.Cleanup(name) &#125; &#125;&#125; GracefulShutdownåŠŸèƒ½ï¼šå¦‚æœè®¾ç½®äº†signalsï¼Œå°±æŠŠè¯¥modulesæ¸…é™¤æ‰ã€‚","categories":[],"tags":[]},{"title":"githubå›¾ç‰‡å¦‚ä½•æ˜¾ç¤ºå‡ºæ¥","slug":"githubå›¾ç‰‡ä¸èƒ½æ˜¾ç¤º","date":"2021-01-05T08:36:47.237Z","updated":"2021-01-05T08:46:13.650Z","comments":true,"path":"2021/01/05/githubå›¾ç‰‡ä¸èƒ½æ˜¾ç¤º/","link":"","permalink":"http://example.com/2021/01/05/github%E5%9B%BE%E7%89%87%E4%B8%8D%E8%83%BD%E6%98%BE%E7%A4%BA/","excerpt":"","text":"å¯¹äºæˆ‘è¿™ä¸ªä¸€å¤©ä¸ç™»githubå°±å¿ƒæ…Œçš„äººæ¥è¯´ï¼Œgithubå›¾ç‰‡ä¸èƒ½æ˜¾ç¤ºï¼Œæ˜¯ä¸€ä¸ªå¤§é—®é¢˜ã€‚ ä¸»è¦åŸå› dnsæ±¡æŸ“ã€‚ è§£å†³æ–¹æ³•ï¼Œé…ç½®æœ¬åœ°hostsæ–‡ä»¶è§£å†³ï¼Œä¸­å›½åŒºdnsæ±¡æŸ“é—®é¢˜ macç”µè„‘ ç»ˆç«¯è¾“å…¥sudo vi /etc/hostsã€‚æŠŠä¸‹é¢å†…å®¹æ·»åŠ è¿›å» 123456789101112131415161718# GitHub Start192.30.253.112 Build software better, together192.30.253.119 gist.github.com151.101.184.133 assets-cdn.github.com151.101.184.133 raw.githubusercontent.com151.101.184.133 gist.githubusercontent.com151.101.184.133 cloud.githubusercontent.com151.101.184.133 camo.githubusercontent.com151.101.184.133 avatars0.githubusercontent.com151.101.184.133 avatars1.githubusercontent.com151.101.184.133 avatars2.githubusercontent.com151.101.184.133 avatars3.githubusercontent.com151.101.184.133 avatars4.githubusercontent.com151.101.184.133 avatars5.githubusercontent.com151.101.184.133 avatars6.githubusercontent.com151.101.184.133 avatars7.githubusercontent.com151.101.184.133 avatars8.githubusercontent.com# GitHub End ä¿å­˜é€€å‡ºï¼Œç™»é™†githubåˆ·æ–°å°±å¯ä»¥æ˜¾ç¤ºå›¾ç‰‡äº†","categories":[],"tags":[]},{"title":"kubeedge æ ¸å¿ƒæ¶æ„ç»„ä»¶è¯¦è§£","slug":"kubeedgeç¬”è®°è¯¦è§£","date":"2021-01-05T03:24:22.448Z","updated":"2021-01-05T12:52:27.600Z","comments":true,"path":"2021/01/05/kubeedgeç¬”è®°è¯¦è§£/","link":"","permalink":"http://example.com/2021/01/05/kubeedge%E7%AC%94%E8%AE%B0%E8%AF%A6%E8%A7%A3/","excerpt":"","text":"kubeedgeåˆ†ä¸ºä¸¤ä¸ªå¯æ‰§è¡Œç¨‹åºï¼ˆcloudcore/edgecoreï¼‰- 8ä¸ªç»„ä»¶cloudcore: CloudHubï¼šäº‘ä¸­çš„é€šä¿¡æ¥å£æ¨¡å—ã€‚ EdgeControllerï¼šç®¡ç†EdgeèŠ‚ç‚¹ã€‚ devicecontroller è´Ÿè´£è®¾å¤‡ç®¡ç†ã€‚ edgecore: Edgedï¼šåœ¨è¾¹ç¼˜ç®¡ç†å®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºã€‚ EdgeHubï¼šEdgeä¸Šçš„é€šä¿¡æ¥å£æ¨¡å—ã€‚ EventBusï¼šä½¿ç”¨MQTTå¤„ç†å†…éƒ¨è¾¹ç¼˜é€šä¿¡ã€‚ DeviceTwinï¼šå®ƒæ˜¯ç”¨äºå¤„ç†è®¾å¤‡å…ƒæ•°æ®çš„è®¾å¤‡çš„è½¯ä»¶é•œåƒã€‚ MetaManagerï¼šå®ƒç®¡ç†è¾¹ç¼˜èŠ‚ç‚¹ä¸Šçš„å…ƒæ•°æ®ã€‚ Edgedè¯¦è§£ï¼š å’Œkubeletçš„åŠŸèƒ½ç›¸ä¼¼ã€‚ä»metamanageræ¥æ”¶å’Œå¤„ç†pod ä¿ç•™config mapå’Œsecretsçš„ç¼“å­˜ å…¶ä»–ï¼š CRIè¾¹ç¼˜åŒ– container/images GC volumeç®¡ç† å„æ¨¡å—è¯¦è§£ eventbus ä¸»è¦ç”¨æ¥å‘é€æ¥æ”¶mqttçš„æ¶ˆæ¯æ¥å£ï¼ˆå¦‚è“ç‰™è®¾å¤‡ç­‰ç­‰ï¼‰ ä¸‰ç§æ¨¡å¼ internalMqttMode/externalMqttMode/bothMqttMode metamanager MetaManageræ˜¯edgedå’Œedgehubä¹‹é—´çš„æ¶ˆæ¯å¤„ç†å™¨ã€‚å®ƒè¿˜è´Ÿè´£å°†å…ƒæ•°æ®å­˜å‚¨åˆ°è½»é‡çº§æ•°æ®åº“ï¼ˆSQLiteï¼‰æˆ–ä»ä¸­æ£€ç´¢å…ƒæ•°æ®ã€‚ å› ä¸ºè¿æ¥SQLiteï¼Œæ‰€ä»¥èƒ½è¿›è¡ŒCRUDæ“ä½œ Edgehub Edge Hubä½¿ç”¨Web socketæˆ–QUICåè®®å’ŒCloudHubç»„ä»¶è¿›è¡Œäº¤äº’ã€‚åŒæ­¥äº‘ç«¯æ›´æ–°å’ŒæŠ¥å‘Šè¾¹ç¼˜ç«¯ä¸»æœºçŠ¶æ€ DeviceTwin è´Ÿè´£å­˜å‚¨è®¾å¤‡çŠ¶æ€ï¼Œå¤„ç†è®¾å¤‡å±æ€§ï¼Œå¤„ç†è®¾å¤‡å­ªç”Ÿæ“ä½œï¼Œåœ¨è¾¹ç¼˜è®¾å¤‡å’Œè¾¹ç¼˜èŠ‚ç‚¹ä¹‹é—´åˆ›å»ºæˆå‘˜èµ„æ ¼ï¼Œå°†è®¾å¤‡çŠ¶æ€åŒæ­¥åˆ°äº‘ä»¥åŠåœ¨è¾¹ç¼˜å’Œäº‘ä¹‹é—´åŒæ­¥è®¾å¤‡å­ªç”Ÿä¿¡æ¯ã€‚å®ƒè¿˜ä¸ºåº”ç”¨ç¨‹åºæä¾›æŸ¥è¯¢æ¥å£ã€‚ ç”±4ä¸ªå­æ¨¡å—ç»„æˆï¼šmembershipï¼Œcommunicationï¼Œdeviceå’Œdevice twin ä»¥ä¸‹ä¸ºäº‘ä¸Šç»„ä»¶ Edge Controller EdgeControlleræ˜¯Kubernetes ApiæœåŠ¡å™¨å’ŒEdgecoreä¹‹é—´çš„æ¡¥æ¢ CloudHub CloudHubæ˜¯cloudcoreçš„ä¸€ä¸ªæ¨¡å—ï¼Œæ˜¯Controllerå’ŒEdgeç«¯ä¹‹é—´çš„ä¸­ä»‹ã€‚å®ƒåŒæ—¶æ”¯æŒåŸºäºWebå¥—æ¥å­—çš„è¿æ¥ä»¥åŠQUICåè®®è®¿é—®ã€‚ åŠŸèƒ½ï¼šå¯ç”¨è¾¹ç¼˜ä¸æ§åˆ¶å™¨ä¹‹é—´çš„é€šä¿¡ Device Controller k8s CRDæ¥æè¿°è®¾å¤‡metadata/status ï¼Œdevicecontrolleråœ¨äº‘å’Œè¾¹ç¼˜ä¹‹é—´åŒæ­¥ï¼Œæœ‰ä¸¤ä¸ªgoroutines: upstream controller/downstream controller","categories":[],"tags":[]},{"title":"dockerfile","slug":"dockerfile","date":"2021-01-04T07:36:23.000Z","updated":"2021-01-04T07:40:35.076Z","comments":true,"path":"2021/01/04/dockerfile/","link":"","permalink":"http://example.com/2021/01/04/dockerfile/","excerpt":"","text":"dockerfileæ„å»ºé•œåƒ1234567891011121314151617FROM alpine:latestADD etcd /usr/local/bin/ADD etcdctl /usr/local/bin/RUN mkdir -p /var/etcd/RUN mkdir -p /var/lib/etcd/# Alpine Linux doesn&#x27;t use pam, which means that there is no /etc/nsswitch.conf,# but Golang relies on /etc/nsswitch.conf to check the order of DNS resolving# (see https://github.com/golang/go/commit/9dee7771f561cf6aee081c0af6658cc81fac3918)# To fix this we just create /etc/nsswitch.conf and add the following line:RUN echo &#x27;hosts: files mdns4_minimal [NOTFOUND=return] dns mdns4&#x27; &gt;&gt; /etc/nsswitch.confEXPOSE 2379 2380# Define default command.CMD [&quot;/usr/local/bin/etcd&quot;] æ„å»ºé•œåƒ docker build -t etcd .","categories":[],"tags":[]},{"title":"dockerå¯åŠ¨etcd","slug":"dockerå¯åŠ¨etcd","date":"2021-01-03T14:48:22.000Z","updated":"2021-01-04T08:48:48.793Z","comments":true,"path":"2021/01/03/dockerå¯åŠ¨etcd/","link":"","permalink":"http://example.com/2021/01/03/docker%E5%90%AF%E5%8A%A8etcd/","excerpt":"","text":"å¯åŠ¨æœåŠ¡docker run -p 2379:2379 -p 2380:2380 â€“name etcd-gcr-v3.4.0 quay.io/coreos/etcd:v3.4.0 /usr/local/bin/etcd â€“name s1 â€“data-dir /etcd-data â€“listen-client-urls http://0.0.0.0:2379 â€“advertise-client-urls http://0.0.0.0:2379 â€“listen-peer-urls http://0.0.0.0:2380 â€“initial-advertise-peer-urls http://0.0.0.0:2380 â€“initial-cluster s1=http://0.0.0.0:2380 â€“initial-cluster-token tkn â€“initial-cluster-state new â€“log-level info â€“logger zap â€“log-outputs stderr æˆ‘é‡åˆ°çš„å‘ é»˜è®¤å¯åŠ¨éƒ½æ˜¯localhostï¼Œç»“æœå¤–éƒ¨è®¿é—®ä¸èƒ½è®¿é—®","categories":[],"tags":[]},{"title":"go-zeroè„šæ‰‹æ¶æ­å»ºå¾®æœåŠ¡ç¬”è®°","slug":"go-zeroå¾®æœåŠ¡æ­å»ºç¬”è®°","date":"2021-01-03T07:02:38.491Z","updated":"2021-01-07T12:34:57.720Z","comments":true,"path":"2021/01/03/go-zeroå¾®æœåŠ¡æ­å»ºç¬”è®°/","link":"","permalink":"http://example.com/2021/01/03/go-zero%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA%E7%AC%94%E8%AE%B0/","excerpt":"","text":"å‡†å¤‡ç¯å¢ƒ å®‰è£…etcd mysql redis æˆ‘éƒ½æ˜¯æ”¾åœ¨dockeré‡Œçš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º å®‰è£…protoc-gen-go å’Œ goctlå·¥å…· go get -u github.com/golang/protobuf/protoc-gen-gogo get -u github.com/tal-tech/go-zero/tools/goctl ç”Ÿæˆç›®å½• goctl api -o bookstore.api1Done. æ˜¾ç¤ºä¸Šé¢æç¤ºè¯´æ˜æˆåŠŸç”Ÿæˆ ç¼–å†™apiæ–‡æ¡£ 1234567891011121314151617181920212223242526272829type ( addReq &#123; book string &#96;form:&quot;book&quot;&#96; price int64 &#96;form:&quot;price&quot;&#96; &#125; addResp &#123; ok bool &#96;json:&quot;ok&quot;&#96; &#125;)type ( checkReq &#123; book string &#96;form:&quot;book&quot;&#96; &#125; checkResp &#123; found bool &#96;json:&quot;found&quot;&#96; price int64 &#96;json:&quot;price&quot;&#96; &#125;)service bookstore-api &#123; @handler AddHandler get &#x2F;add (addReq) returns (addResp) @handler CheckHandler get &#x2F;check (checkReq) returns (checkResp)&#125; ç¼–å†™å®Œä¸Šé¢å†…å®¹ï¼Œå¯åŠ¨ç”Ÿæˆå‘½ä»¤ goctl api go -api bookstore.api -dir . å¯åŠ¨æµ‹è¯•æœåŠ¡ go run bookstore.go -f etc/bookstore-api.yaml è®¿é—®ç»“æœ 123456curl -i &quot;http:&#x2F;&#x2F;localhost:8888&#x2F;check?book&#x3D;go-zero&quot;HTTP&#x2F;1.1 200 OKContent-Type: application&#x2F;jsonDate: Sun, 03 Jan 2021 07:46:30 GMTContent-Length: 25&#123;&quot;found&quot;:false,&quot;price&quot;:0&#125; ç¼–å†™rpcæœåŠ¡ï¼ˆADDæœåŠ¡ï¼‰ åˆ›å»ºrpcç›®å½•ï¼Œè¿›å…¥ç›®å½• goctl rpc template -o add.proto ç”Ÿæˆæ¨¡ç‰ˆ åœ¨æ–‡ä»¶å¤¹ä¸­ç¼–å†™add.proto 12345678910111213141516syntax &#x3D; &quot;proto3&quot;;package add;message addReq &#123; string book &#x3D; 1; int64 price &#x3D; 2;&#125;message addResp &#123; bool ok &#x3D; 1;&#125;service adder &#123; rpc add(addReq) returns(addResp);&#125; goctl rpc proto -src add.proto -dir . ç”ŸæˆrpcæœåŠ¡ è¿è¡ŒæœåŠ¡ go run add.go -f etc/add.yaml æ­¤å¤„ä¼šå»è¿æ¥etcdçš„ç«¯å£(å¦‚æœæ²¡æœ‰etcdçš„æœåŠ¡å°±ä¼šåœ¨è¿™é‡ŒæŠ¥é”™)ï¼Œå…·ä½“é…ç½®æ–‡ä»¶åœ¨rpc/etc/add.yaml ç¼–å†™rpcæœåŠ¡ï¼ˆCHECKæœåŠ¡ï¼‰åŒä¸Šé…ç½® api serverbookstore-api.yamlæŠŠrpcæœåŠ¡å†™å…¥12345678910Add: Etcd: Hosts: - localhost:2379 Key: add.rpcCheck: Etcd: Hosts: - localhost:2379 Key: check.rpc ä¿®æ”¹internal/config/config.goå¦‚ä¸‹ï¼Œå¢åŠ add/checkæœåŠ¡ä¾èµ–1234567type Config struct &#123; rest.RestConf Add zrpc.RpcClientConf &#x2F;&#x2F; æ‰‹åŠ¨ä»£ç  Check zrpc.RpcClientConf &#x2F;&#x2F; æ‰‹åŠ¨ä»£ç &#125; ä¿®æ”¹internal/svc/servicecontext.go12345678910111213type ServiceContext struct &#123; Config config.Config Adder adder.Adder &#x2F;&#x2F; æ‰‹åŠ¨ä»£ç  Checker checker.Checker &#x2F;&#x2F; æ‰‹åŠ¨ä»£ç &#125;func NewServiceContext(c config.Config) *ServiceContext &#123; return &amp;ServiceContext&#123; Config: c, Adder: adder.NewAdder(zrpc.MustNewClient(c.Add)), &#x2F;&#x2F; æ‰‹åŠ¨ä»£ç  Checker: checker.NewChecker(zrpc.MustNewClient(c.Check)), &#x2F;&#x2F; æ‰‹åŠ¨ä»£ç  &#125;&#125; ä¿®æ”¹internal/logic/addlogic.goé‡Œçš„Add123456789101112131415func (l *AddLogic) Add(req types.AddReq) (*types.AddResp, error) &#123; &#x2F;&#x2F; æ‰‹åŠ¨ä»£ç å¼€å§‹ resp, err :&#x3D; l.svcCtx.Adder.Add(l.ctx, &amp;adder.AddReq&#123; Book: req.Book, Price: req.Price, &#125;) if err !&#x3D; nil &#123; return nil, err &#125; return &amp;types.AddResp&#123; Ok: resp.Ok, &#125;, nil &#x2F;&#x2F; æ‰‹åŠ¨ä»£ç ç»“æŸ&#125; åŒç†ä¿®æ”¹internal/logic/checklogic.goé‡Œçš„Check12345678910111213141516func (l *CheckLogic) Check(req types.CheckReq) (*types.CheckResp, error) &#123; &#x2F;&#x2F; æ‰‹åŠ¨ä»£ç å¼€å§‹ resp, err :&#x3D; l.svcCtx.Checker.Check(l.ctx, &amp;checker.CheckReq&#123; Book: req.Book, &#125;) if err !&#x3D; nil &#123; logx.Error(err) return &amp;types.CheckResp&#123;&#125;, err &#125; return &amp;types.CheckResp&#123; Found: resp.Found, Price: resp.Price, &#125;, nil &#x2F;&#x2F; æ‰‹åŠ¨ä»£ç ç»“æŸ&#125; å®šä¹‰æ•°æ®åº“è¡¨ç»“æ„123456CREATE TABLE `book`( `book` varchar(255) NOT NULL COMMENT &#x27;book name&#x27;, `price` int NOT NULL COMMENT &#x27;book price&#x27;, PRIMARY KEY(`book`)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; è¿æ¥ä¸Šmysqlæ•°æ®åº“ï¼Œåˆ›å»ºgozeroæ•°æ®åº“ ideaè¿æ¥æ•°æ®åº“ å‚è€ƒè¿æ¥ï¼šhttps://juejin.cn/post/6844904036802494477 ä½¿ç”¨ideaå‘½ä»¤æ‰§è¡ŒsqlæŒ‡ä»¤ã€‚ ç”Ÿæˆredis cache1goctl model mysql ddl -c -src book.sql -dir . ä¿®æ”¹rpcä»£ç è°ƒç”¨crud cache åœ¨roc/add/etc/add.yamlå’Œroc/check/etc/check.yamlåŠ å…¥ä¸‹é¢çš„ä»£ç  1234DataSource: root:@tcp(localhost:3306)/gozeroTable: bookCache: - Host: localhost:6379 å¢åŠ äº†mysqlå’Œredis cacheé…ç½® ä¿®æ”¹rpc/add/internal/config.goå’Œrpc/check/internal/config.goï¼Œå¦‚ä¸‹ï¼š 12345type Config struct &#123; zrpc.RpcServerConf DataSource string // æ‰‹åŠ¨ä»£ç  Cache cache.CacheConf // æ‰‹åŠ¨ä»£ç &#125; ä¿®æ”¹rpc/add/internal/svc/servicecontext.goå’Œrpc/check/internal/svc/servicecontext.goï¼Œå¦‚ä¸‹ï¼š 1234567891011type ServiceContext struct &#123; c config.Config Model model.BookModel // æ‰‹åŠ¨ä»£ç &#125;func NewServiceContext(c config.Config) *ServiceContext &#123; return &amp;ServiceContext&#123; c: c, Model: model.NewBookModel(sqlx.NewMysql(c.DataSource), c.Cache), // æ‰‹åŠ¨ä»£ç  &#125;&#125; ä¿®æ”¹rpc/add/internal/logic/addlogic.goï¼Œå¦‚ä¸‹(é€»è¾‘ä»£ç ) 123456789101112131415func (l *AddLogic) Add(in *add.AddReq) (*add.AddResp, error) &#123; // æ‰‹åŠ¨ä»£ç å¼€å§‹ _, err := l.svcCtx.Model.Insert(model.Book&#123; Book: in.Book, Price: in.Price, &#125;) if err != nil &#123; return nil, err &#125; return &amp;add.AddResp&#123; Ok: true, &#125;, nil // æ‰‹åŠ¨ä»£ç ç»“æŸ&#125; ä¿®æ”¹rpc/check/internal/logic/checklogic.goï¼Œå¦‚ä¸‹ï¼š 12345678910111213func (l *CheckLogic) Check(in *check.CheckReq) (*check.CheckResp, error) &#123; // æ‰‹åŠ¨ä»£ç å¼€å§‹ resp, err := l.svcCtx.Model.FindOne(in.Book) if err != nil &#123; return nil,err &#125; return &amp;check.CheckResp&#123; Found: true, Price: resp.Price, &#125;, nil // æ‰‹åŠ¨ä»£ç ç»“æŸ&#125; è°ƒç”¨æ¼”ç¤º å¯åŠ¨æ‰€æœ‰rpcæœåŠ¡ å¯åŠ¨apiæœåŠ¡ è®¿é—®apiæœåŠ¡ 1curl -i &quot;http://localhost:8888/add?book=go-zero&amp;price=10&quot; å¦‚ä¸‹å›¾æ˜¾ç¤ºè¿è¡Œ æ­¤æ—¶å¯¹äºçš„rpcæœåŠ¡å’Œapiæ—¥å¿—éƒ½ä¼šæœ‰å“åº” ç»è¿‡æµ‹è¯•å¾—ï¼Œæ·»åŠ è¯·æ±‚ä¸ä¼šå­˜å…¥redisï¼Œè¯»å–è¯·æ±‚ä¼šå†™å…¥redisä¸­ã€‚ benchmarkæŠ—å‹æµ‹è¯• é¦–å…ˆè°ƒæ•´mysqlçš„å¥æŸ„æ•° 1ulimit -n 100000 ä½¿ç”¨wrkè¿›è¡ŒæŠ—å‹æµ‹è¯• 1wrk -t10 -c1000 -d40s --latency &quot;http://localhost:8888/check?book=go-zero&quot; æµ‹è¯•ç»“æœå›¾å¦‚ä¸‹ï¼šå…³äºwrkå‚è€ƒé“¾æ¥ï¼ˆhttps://www.cnblogs.com/xinzhao/p/6233009.htmlï¼‰","categories":[],"tags":[]},{"title":"markdownç¬”è®°","slug":"markdownç¬”è®°","date":"2020-12-30T03:42:00.849Z","updated":"2020-12-30T10:48:10.414Z","comments":true,"path":"2020/12/30/markdownç¬”è®°/","link":"","permalink":"http://example.com/2020/12/30/markdown%E7%AC%94%E8%AE%B0/","excerpt":"","text":"æ’å›¾ä¸‰ç§æ–¹å¼12345678910111213åŸºç¡€æ ¼å¼ï¼š![Alt text](å›¾ç‰‡é“¾æ¥ &quot;optional title&quot;)æ–¹æ³•ä¸€ï¼šæ’å…¥æœ¬åœ°å›¾ç‰‡![avatar](&#x2F;home&#x2F;picture&#x2F;1.png)æ–¹æ³•äºŒï¼šæ’å…¥ç½‘ç»œå›¾ç‰‡![avatar](http:&#x2F;&#x2F;baidu.com&#x2F;pic&#x2F;doge.png)æ–¹æ³•ä¸‰ï¼šæŠŠå›¾ç‰‡å­˜å…¥markdownæ–‡ä»¶![avatar][base64str][base64str]:data:image&#x2F;png;base64,iVBORw0......","categories":[],"tags":[]},{"title":"åŸºç¡€å‘½ä»¤æ—¥å¸¸æ€»ç»“","slug":"linuxåŸºç¡€å‘½ä»¤","date":"2020-12-29T06:31:08.664Z","updated":"2020-12-30T10:50:33.328Z","comments":true,"path":"2020/12/29/linuxåŸºç¡€å‘½ä»¤/","link":"","permalink":"http://example.com/2020/12/29/linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/","excerpt":"","text":"netstat -apn | grep 8080 æˆ–è€… lsof -i:8080 æ ¹æ®ç«¯å£æŸ¥PID netstat -apn | grep 21299 æ ¹æ®PIDæŸ¥ç«¯å£ kill -9 PID æ€æ­»PIDå¯¹åº”çš„ç«¯å£ nohup ./main &gt; /dev/null 2&gt;&amp;1 &amp; åç«¯å¯åŠ¨mainæœåŠ¡, å¹¶ä¸”è¿”å›PIDå· 1234ä¾‹å¦‚ï¼šå‚è€ƒé“¾æ¥ï¼š https://blog.csdn.net/m0_46657040/article/details/109611803[root@k8s-master-81 harmoryedge]# nohup ./main &gt; /dev/null 2&gt;&amp;1 &amp;[1] 21299 cd /proc/21299 &amp;&amp; ll é€šè¿‡PIDå·æŸ¥è¯¢æœåŠ¡è·¯å¾„ç­‰ä¿¡æ¯ npm run start å¯åŠ¨å‰ç«¯startç¨‹åº(reactæˆ–è€…vue)","categories":[],"tags":[]},{"title":"YOU-GETç¬”è®°","slug":"you-getç¬”è®°","date":"2020-12-25T06:29:11.892Z","updated":"2020-12-30T10:51:36.257Z","comments":true,"path":"2020/12/25/you-getç¬”è®°/","link":"","permalink":"http://example.com/2020/12/25/you-get%E7%AC%94%E8%AE%B0/","excerpt":"","text":"å‚è€ƒè¿æ¥ https://github.com/soimort/you-get å®‰è£…ï¼š brew install you-get ä½¿ç”¨ you-get â€˜https://www.youtube.com/watch?v=jNQXAC9IVRw&#39; æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ you-get -i â€˜https://www.youtube.com/watch?v=jNQXAC9IVRw&#39;","categories":[],"tags":[]},{"title":"goæµ‹è¯•ç« èŠ‚","slug":"gotestæµ‹è¯•å·¥å…·ç¬”è®°","date":"2020-12-24T12:21:29.025Z","updated":"2020-12-30T10:49:27.756Z","comments":true,"path":"2020/12/24/gotestæµ‹è¯•å·¥å…·ç¬”è®°/","link":"","permalink":"http://example.com/2020/12/24/gotest%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E7%AC%94%E8%AE%B0/","excerpt":"","text":"gotestæ–‡æœ¬å¦‚ä½•ä¹¦å†™1234567891011121314151617181920212223242526//è¡¨æ ¼é©±åŠ¨æµ‹è¯•func TestXXX(t * testint.T)&#123; // å®šä¹‰è¾“å…¥è¾“å‡º tests := []struct&#123; in int out int &#125;&#125;&#123; // æµ‹è¯•æ•°æ® &#123;1, 1&#125;ï¼Œ &#123;2, 2&#125;, ...&#125;for _, tt := range tests &#123; //é€šè¿‡å‡½æ•°æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ actual := éœ€è¦æµ‹è¯•çš„å‡½æ•°å(tt.in) if actual != tt.out &#123; //è¾“å‡ºä¸åŒ¹é…çš„ä¿¡æ¯ //errofè¾“å‡º t.Errof(t.Errorf(&quot;got %d for input %s; expected %d&quot;, actual, tt.in, tt.out)) //Skipfè¾“å‡º t.Skipf(t.Errorf(&quot;got %d for input %s; expected %d&quot;, actual, tt.in, tt.out)) //logfè¾“å‡º t.Logf(t.Errorf(&quot;got %d for input %s; expected %d&quot;, actual, tt.in, tt.out)) &#125;&#125; è¡¨æ ¼é©±åŠ¨æµ‹è¯•è¯­å¥ï¼ˆåé¢é€šè¿‡æ­£åˆ™åŒ¹é…ï¼‰ go test -v -timeout 30s . -run ^TestXXX$ go test å’Œgo tool æ€§èƒ½æµ‹è¯•ï¼ˆå…·ä½“å¯ä»¥é€šè¿‡go tool cover æŸ¥è¯¢å…·ä½“å‘½ä»¤ï¼‰ go test -coverprofile=cover.out è¾“å‡ºcpuè¦†ç›–ç‡ go tool cover -html=cover.out htmlæ˜¾ç¤ºcpuæ•°æ® go test -bench xxx.go ç›®æ ‡æ–‡ä»¶benchæ€§èƒ½æµ‹è¯•,çœ‹èŠ±çš„æ—¶é—´ go pprofæµ‹è¯• go test help helpæç¤ºä¿¡æ¯ go test -bench nonrepeatingsubstr -cpuprofile cpu.out ç”Ÿæˆç›®æ ‡æ–‡ä»¶çš„cpuä½¿ç”¨æƒ…å†µ go tool pprof cpu.out help webpprofäº¤äº’å¼æ˜¾ç¤º godoc æ–‡æ¡£ godoc â€“helpgodocä½¿ç”¨æ–‡æ¡£ godoc -http :6060æœåŠ¡å™¨å½¢å¼æ‰“å¼€goå‚è€ƒæ‰‹å†Œ","categories":[],"tags":[]},{"title":"åˆçœ‹ç»„ä»¶ 7å¤§ç»„ä»¶+1ä¸ªè¿è¡Œæ—¶ï¼ˆmaster 5 + node 2ï¼‰","slug":"kubernetesç»„ä»¶è¯¦ç»†ç¬”è®°","date":"2020-12-18T06:03:37.149Z","updated":"2020-12-30T10:49:52.254Z","comments":true,"path":"2020/12/18/kubernetesç»„ä»¶è¯¦ç»†ç¬”è®°/","link":"","permalink":"http://example.com/2020/12/18/kubernetes%E7%BB%84%E4%BB%B6%E8%AF%A6%E7%BB%86%E7%AC%94%E8%AE%B0/","excerpt":"","text":"kube-apiserverï¼ˆ1ï¼‰API æœåŠ¡å™¨æ˜¯ Kubernetes æ§åˆ¶é¢çš„ç»„ä»¶ï¼Œ è¯¥ç»„ä»¶å…¬å¼€äº† Kubernetes APIã€‚ API æœåŠ¡å™¨æ˜¯ Kubernetes æ§åˆ¶é¢çš„å‰ç«¯ã€‚ Kubernetes API æœåŠ¡å™¨çš„ä¸»è¦å®ç°æ˜¯ kube-apiserverã€‚ kube-apiserver è®¾è®¡ä¸Šè€ƒè™‘äº†æ°´å¹³ä¼¸ç¼©ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¯é€šè¿‡éƒ¨ç½²å¤šä¸ªå®ä¾‹è¿›è¡Œä¼¸ç¼©ã€‚ ä½ å¯ä»¥è¿è¡Œ kube-apiserver çš„å¤šä¸ªå®ä¾‹ï¼Œå¹¶åœ¨è¿™äº›å®ä¾‹ä¹‹é—´å¹³è¡¡æµé‡ã€‚ etcd ï¼ˆ2ï¼‰etcd æ˜¯å…¼å…·ä¸€è‡´æ€§å’Œé«˜å¯ç”¨æ€§çš„é”®å€¼æ•°æ®åº“ï¼Œå¯ä»¥ä½œä¸ºä¿å­˜ Kubernetes æ‰€æœ‰é›†ç¾¤æ•°æ®çš„åå°æ•°æ®åº“ã€‚ æ‚¨çš„ Kubernetes é›†ç¾¤çš„ etcd æ•°æ®åº“é€šå¸¸éœ€è¦æœ‰ä¸ªå¤‡ä»½è®¡åˆ’ã€‚ è¦äº†è§£ etcd æ›´æ·±å±‚æ¬¡çš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒ etcd æ–‡æ¡£ã€‚ kube-schedulerï¼ˆ3ï¼‰ä¸»èŠ‚ç‚¹ä¸Šçš„ç»„ä»¶ï¼Œè¯¥ç»„ä»¶ç›‘è§†é‚£äº›æ–°åˆ›å»ºçš„æœªæŒ‡å®šè¿è¡ŒèŠ‚ç‚¹çš„ Podï¼Œå¹¶é€‰æ‹©èŠ‚ç‚¹è®© Pod åœ¨ä¸Šé¢è¿è¡Œã€‚ è°ƒåº¦å†³ç­–è€ƒè™‘çš„å› ç´ åŒ…æ‹¬å•ä¸ª Pod å’Œ Pod é›†åˆçš„èµ„æºéœ€æ±‚ã€ç¡¬ä»¶/è½¯ä»¶/ç­–ç•¥çº¦æŸã€äº²å’Œæ€§å’Œåäº²å’Œæ€§è§„èŒƒã€æ•°æ®ä½ç½®ã€å·¥ä½œè´Ÿè½½é—´çš„å¹²æ‰°å’Œæœ€åæ—¶é™ã€‚ kube-controller-managerï¼ˆ4ï¼‰åœ¨ä¸»èŠ‚ç‚¹ä¸Šè¿è¡Œ æ§åˆ¶å™¨ çš„ç»„ä»¶ã€‚ ä»é€»è¾‘ä¸Šè®²ï¼Œæ¯ä¸ªæ§åˆ¶å™¨éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ï¼Œ ä½†æ˜¯ä¸ºäº†é™ä½å¤æ‚æ€§ï¼Œå®ƒä»¬éƒ½è¢«ç¼–è¯‘åˆ°åŒä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­è¿è¡Œã€‚ è¿™äº›æ§åˆ¶å™¨åŒ…æ‹¬: èŠ‚ç‚¹æ§åˆ¶å™¨ï¼ˆNode Controllerï¼‰: è´Ÿè´£åœ¨èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶è¿›è¡Œé€šçŸ¥å’Œå“åº”ã€‚å‰¯æœ¬æ§åˆ¶å™¨ï¼ˆReplication Controllerï¼‰: è´Ÿè´£ä¸ºç³»ç»Ÿä¸­çš„æ¯ä¸ªå‰¯æœ¬æ§åˆ¶å™¨å¯¹è±¡ç»´æŠ¤æ­£ç¡®æ•°é‡çš„ Podã€‚ç«¯ç‚¹æ§åˆ¶å™¨ï¼ˆEndpoints Controllerï¼‰: å¡«å……ç«¯ç‚¹(Endpoints)å¯¹è±¡(å³åŠ å…¥ Service ä¸ Pod)ã€‚æœåŠ¡å¸æˆ·å’Œä»¤ç‰Œæ§åˆ¶å™¨ï¼ˆService Account &amp; Token Controllersï¼‰: ä¸ºæ–°çš„å‘½åç©ºé—´åˆ›å»ºé»˜è®¤å¸æˆ·å’Œ API è®¿é—®ä»¤ç‰Œ. cloud-controller-managerï¼ˆ5ï¼‰äº‘æ§åˆ¶å™¨ç®¡ç†å™¨æ˜¯æŒ‡åµŒå…¥ç‰¹å®šäº‘çš„æ§åˆ¶é€»è¾‘çš„ æ§åˆ¶å¹³é¢ç»„ä»¶ã€‚ äº‘æ§åˆ¶å™¨ç®¡ç†å™¨å…è®¸æ‚¨é“¾æ¥èšåˆåˆ°äº‘æä¾›å•†çš„åº”ç”¨ç¼–ç¨‹æ¥å£ä¸­ï¼Œ å¹¶åˆ†ç¦»å‡ºç›¸äº’ä½œç”¨çš„ç»„ä»¶ä¸æ‚¨çš„é›†ç¾¤äº¤äº’çš„ç»„ä»¶ã€‚cloud-controller-manager ä»…è¿è¡Œç‰¹å®šäºäº‘å¹³å°çš„æ§åˆ¶å›è·¯ã€‚ å¦‚æœä½ åœ¨è‡ªå·±çš„ç¯å¢ƒä¸­è¿è¡Œ Kubernetesï¼Œæˆ–è€…åœ¨æœ¬åœ°è®¡ç®—æœºä¸­è¿è¡Œå­¦ä¹ ç¯å¢ƒï¼Œ æ‰€éƒ¨ç½²çš„ç¯å¢ƒä¸­ä¸éœ€è¦äº‘æ§åˆ¶å™¨ç®¡ç†å™¨ã€‚ ä¸ kube-controller-manager ç±»ä¼¼ï¼Œcloud-controller-manager å°†è‹¥å¹²é€»è¾‘ä¸Šç‹¬ç«‹çš„ æ§åˆ¶å›è·¯ç»„åˆåˆ°åŒä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œä¾›ä½ ä»¥åŒä¸€è¿›ç¨‹çš„æ–¹å¼è¿è¡Œã€‚ ä½ å¯ä»¥å¯¹å…¶æ‰§è¡Œæ°´å¹³æ‰©å®¹ï¼ˆè¿è¡Œä¸æ­¢ä¸€ä¸ªå‰¯æœ¬ï¼‰ä»¥æå‡æ€§èƒ½æˆ–è€…å¢å¼ºå®¹é”™èƒ½åŠ›ã€‚ ä¸‹é¢çš„æ§åˆ¶å™¨éƒ½åŒ…å«å¯¹äº‘å¹³å°é©±åŠ¨çš„ä¾èµ–ï¼š èŠ‚ç‚¹æ§åˆ¶å™¨ï¼ˆNode Controllerï¼‰: ç”¨äºåœ¨èŠ‚ç‚¹ç»ˆæ­¢å“åº”åæ£€æŸ¥äº‘æä¾›å•†ä»¥ç¡®å®šèŠ‚ç‚¹æ˜¯å¦å·²è¢«åˆ é™¤è·¯ç”±æ§åˆ¶å™¨ï¼ˆRoute Controllerï¼‰: ç”¨äºåœ¨åº•å±‚äº‘åŸºç¡€æ¶æ„ä¸­è®¾ç½®è·¯ç”±æœåŠ¡æ§åˆ¶å™¨ï¼ˆService Controllerï¼‰: ç”¨äºåˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤äº‘æä¾›å•†è´Ÿè½½å‡è¡¡å™¨ Node ç»„ä»¶ kubeletï¼ˆ6ï¼‰ä¸€ä¸ªåœ¨é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ä»£ç†ã€‚ å®ƒä¿è¯å®¹å™¨éƒ½è¿è¡Œåœ¨ Pod ä¸­ã€‚ kubelet æ¥æ”¶ä¸€ç»„é€šè¿‡å„ç±»æœºåˆ¶æä¾›ç»™å®ƒçš„ PodSpecsï¼Œç¡®ä¿è¿™äº› PodSpecs ä¸­æè¿°çš„å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ä¸”å¥åº·ã€‚ kubelet ä¸ä¼šç®¡ç†ä¸æ˜¯ç”± Kubernetes åˆ›å»ºçš„å®¹å™¨ã€‚ kube-proxy ï¼ˆ7ï¼‰kube-proxy æ˜¯é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ç½‘ç»œä»£ç†ï¼Œ å®ç° Kubernetes æœåŠ¡ï¼ˆServiceï¼‰ æ¦‚å¿µçš„ä¸€éƒ¨åˆ†ã€‚ kube-proxy ç»´æŠ¤èŠ‚ç‚¹ä¸Šçš„ç½‘ç»œè§„åˆ™ã€‚è¿™äº›ç½‘ç»œè§„åˆ™å…è®¸ä»é›†ç¾¤å†…éƒ¨æˆ–å¤–éƒ¨çš„ç½‘ç»œä¼šè¯ä¸ Pod è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚ å¦‚æœæ“ä½œç³»ç»Ÿæä¾›äº†æ•°æ®åŒ…è¿‡æ»¤å±‚å¹¶å¯ç”¨çš„è¯ï¼Œkube-proxy ä¼šé€šè¿‡å®ƒæ¥å®ç°ç½‘ç»œè§„åˆ™ã€‚å¦åˆ™ï¼Œ kube-proxy ä»…è½¬å‘æµé‡æœ¬èº«ã€‚ å®¹å™¨è¿è¡Œæ—¶ï¼ˆContainer Runtimeï¼‰ï¼ˆ8ï¼‰å®¹å™¨è¿è¡Œç¯å¢ƒæ˜¯è´Ÿè´£è¿è¡Œå®¹å™¨çš„è½¯ä»¶ã€‚ Kubernetes æ”¯æŒå¤šä¸ªå®¹å™¨è¿è¡Œç¯å¢ƒ: Dockerã€ containerdã€CRI-O ä»¥åŠä»»ä½•å®ç° Kubernetes CRI (å®¹å™¨è¿è¡Œç¯å¢ƒæ¥å£)ã€‚ æ’ä»¶ï¼ˆAddonsï¼‰ cattleæœ‰é›†ç¾¤ DNS Dashboardweb ç•Œé¢ prometheuså®¹å™¨èµ„æºç›‘æ§ EFKæ—¥å¿—ç›‘æ§ nodeèŠ‚ç‚¹å¼€å§‹ èŠ‚ç‚¹ä¸Šçš„ç»„ä»¶åŒ…æ‹¬ kubeletã€ å®¹å™¨è¿è¡Œæ—¶ä»¥åŠ kube-proxyã€‚ èŠ‚ç‚¹äºapiæœåŠ¡å™¨äº¤äº’ï¼Œé€šè¿‡èŠ‚ç‚¹ä¸Škubectlè‡ªæ³¨å†Œå…¥é›†ç¾¤ å­æ³¨å†Œå‚æ•°: èŠ‚ç‚¹ç”Ÿæˆå®Œæˆåé€šè¿‡kubeadm joinæ³¨å†Œ12345678910&quot;conditions&quot;: [ &#123; &quot;type&quot;: &quot;Ready&quot;, &quot;status&quot;: &quot;True&quot;, &quot;reason&quot;: &quot;KubeletReady&quot;, &quot;message&quot;: &quot;kubelet is posting ready status&quot;, &quot;lastHeartbeatTime&quot;: &quot;2019-06-05T18:38:35Z&quot;, &quot;lastTransitionTime&quot;: &quot;2019-06-05T11:41:27Z&quot; &#125;] Ready æ¡ä»¶å¤„äº Unknown æˆ–è€… False çŠ¶æ€çš„æ—¶é—´è¶…è¿‡äº† pod-eviction-timeout, é»˜è®¤æ˜¯5åˆ†é’Ÿï¼Œå°±ä¼šè¢«é©±é€ã€‚","categories":[],"tags":[]},{"title":"è¿æ¥kubernetes","slug":"kubernetesAPIè°ƒç”¨","date":"2020-12-10T06:18:12.992Z","updated":"2020-12-30T10:59:13.914Z","comments":true,"path":"2020/12/10/kubernetesAPIè°ƒç”¨/","link":"","permalink":"http://example.com/2020/12/10/kubernetesAPI%E8%B0%83%E7%94%A8/","excerpt":"","text":"client-go é€šè¿‡client-goè·å–kubeconfigè®¿é—®é›†ç¾¤ å‚è€ƒæ–‡çŒ®ï¼š https://blog.csdn.net/qq_37950254/article/details/89603207 https://github.com/kubernetes/client-go/blob/master/examples/out-of-cluster-client-configuration/main.go https://kubernetes.io/zh/docs/tasks/administer-cluster/access-cluster-api/ https://my.oschina.net/u/4382516/blog/3303251 æ™®é€šè°ƒç”¨çš„æ–¹æ³•ï¼š 123$ kubectl create sa my-sa $ kubect1 create clusterrolebinding my-clusterrolebinding --clusterrole-cluster-admin --serviceaccount=default:my-sa $ export TOKEN=&#x27;kubect1 get secret s(kubect1 get secret | grep my-sa | awk &#x27;(print $l&#125;&#x27;) -ojsonpath=(.data.token&#125; I base64 -d k8så¼€å¯httpç«¯å£ è®¿é—®apiserverçš„http8080ç«¯å£éœ€è¦å¼€å¯ï¼Œapiserverçš„podçš„ä¸å®‰å…¨æœåŠ¡ç«¯å£ vim /etc/kubernetes/manifests/kube-apiserver.yaml ä¿®æ”¹ â€“insecure-port=8080 å®šä¹‰ä¸€ä¸ªpodæœ€èµ·ç çš„é…ç½®12345678910111213141516171819202122232425262728293031323334353637apiVersion: v1kind: Pod ï¼ˆå¯å¡« Deploymentã€Jobã€Ingressã€Serviceï¼‰metadata: name: pod1 namespace: namespace1 labels: mycustome.pod.label: customePodLabel spec: containers: - name: container1 image: xxxdockeré•œåƒ imagePullPolice: IfNotPresent command: ã€å¼€å¯åæ‰§è¡Œçš„ç¬¬ä¸€å¥è„šæœ¬è¯­è¨€ã€‘.sh workingDir: xxxè·¯å¾„[åˆ›å»ºå·¥ä½œçš„å†…å®¹ä¼šè¿™ä¸ªdockerè·¯å¾„ä¸‹] volumeMounts: - name: æŒ‚è½½åç§°1 mountPath: æœ¬åœ°è·¯å¾„ port: - name: portname1 hostport: æœ¬åœ°ç«¯å£ env: - name: envname1 value: ç¯å¢ƒå˜é‡å€¼ resource: limits: cpu: 250m memory: 100kb secret: secretName: secretName1 items: - key: k1 path: å®¹å™¨secretè·¯å¾„ configMap: name: CM1 items: - key: cm1k1 path: å®¹å™¨configMapè·¯å¾„ ç»¼ä¸Šå¾—ï¼Œå®šä¹‰ä¸€ä¸ªpodéœ€è¦ apiversion/ kind/ metadata/ podname/ namespaces/ labels/ containername/ containerimages/ imagePullPolice/ workingdir/ volumeMounts/ name/ mountPath/ port/ name/ hostport/ env/ name value resource/ limits/ cpu/ momory/ secret/ æ€è·¯å®šä¹‰podâ€”&gt;conatiner-&gt;image/port/volume/env/resource å®šä¹‰ä¸€ä¸ªdeploymentæœ€èµ·ç çš„é…ç½®1234567891011121314151617181920apiVersion: apps/v1kind: Deploymentnamespaces: my-custome-namespacesmetadata: name: ç®¡ç†æŒ‡å®špodçš„deploymentspec: replicas: æ•°é‡ selector: matchLabels: //é€šè¿‡labelé€‰æ‹©pod mycustome.pod.label: customePodLabel //labelé€‰æ‹©å™¨ template: //æ¨¡ç‰ˆ metadata: labels: mycustome.pod.label: customePodLabel //é€‰æ‹©è¯¥labelçš„pod spec: containers: //æœŸæœ›åˆ›å»ºçš„å®¹å™¨ - name: nginx image: nginx:1.10 ports: - containerPort: 80 kubectl edit deploy/custome-deployment-nginx ä¿®æ”¹deployment kubectl get deployment â€“show-labels å±•ç¤ºlabel kubectl rollout status deploy/custome-deployment-nginx æŸ¥çœ‹å‘å¸ƒçŠ¶æ€ kubectl rollout history deploy/custome-deployment-nginx æŸ¥çœ‹å†å²çŠ¶æ€ kubectl rollout undo deploy/nginx-deployment â€“to-revision=1 å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬ kubectl set image deploy/custome-deployment-nginx nginx=nginx:1.11 æ›´æ–°é•œåƒ kubectl scale â€“replicas=10 deployment/custome-deployment-nginx æ‰©å®¹ å®šä¹‰ä¸€ä¸ªserviceæœ€èµ·ç çš„é…ç½®123456789101112apiVersion: v1kind: Servicemetadata: name: nginx-service labels: myCustomePodLabel: customePodLabelspec: ports: - port: 88 targetPort: 80 selector: myCustomePodLabel: customePodLabel kubectl edit svc/nginx-service ä¿®æ”¹svcé…ç½® k8sè°ƒåº¦å™¨ï¼Œé¢„é€‰ç­–ç•¥å’Œä¼˜é€‰å‡½æ•°ï¼ˆhttps://www.cnblogs.com/klvchen/p/10024846.htmlï¼‰ é€šè¿‡æ‰‹åŠ¨å»å®ç° éœ€è¦ç»™æŒ‡å®šçš„nodeæ­ä¸ŠæŒ‡å®šå…¬å¸çš„labelæ ‡ç­¾ï¼Œè¯´æ˜å±äºå“ªä¸ªå…¬å¸ 1kubectl label nodes k8s-master02 type=company02 æŠŠpodæˆ–è€…deploymentä»¥yamlæ–¹å¼è¾“å‡º 1kubectl get pod zeus-86784767b5-j7hqh -o=yaml pod çŠ¶æ€ ä¸‰ç§è°ƒåº¦çŠ¶æ€ï¼šWaitingï¼ˆç­‰å¾…ï¼‰ã€Runningï¼ˆè¿è¡Œä¸­ï¼‰å’Œ Terminatedï¼ˆå·²ç»ˆæ­¢ï¼‰ æ¢é’ˆçš„ç±»å‹ ExecActionï¼ˆå‘½ä»¤æ‰§è¡Œï¼‰ã€TCPSocketActionã€ HTTPGetAction ä¸¤ç§æ¢é’ˆ å­˜æ´»æ¢é’ˆã€å°±ç»ªæ¢é’ˆ pauseå®¹å™¨åŠŸèƒ½ å®ƒæä¾›æ•´ä¸ªpodçš„Linuxå‘½åç©ºé—´çš„åŸºç¡€ã€‚ å¯ç”¨PIDå‘½åç©ºé—´ï¼Œå®ƒåœ¨æ¯ä¸ªpodä¸­éƒ½ä½œä¸ºPIDä¸º1è¿›ç¨‹ï¼Œå¹¶å›æ”¶åƒµå°¸è¿›ç¨‹","categories":[],"tags":[]}],"categories":[],"tags":[]}